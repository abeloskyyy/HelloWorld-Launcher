<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Loader Inicial -->
    <div id="initialLoader" class="loader-container">
        <div class="cube-spinner">
            <div class="face-back"></div>
            <div class="face-right"></div>
            <div class="face-left"></div>
            <div class="face-top"></div>
            <div class="face-bottom"></div>
            <div class="face-front"></div>
        </div>
    </div>

    <div class="launcher">
        <!-- Botón de inicio de sesión / User Badge -->
        <div id="userBadge" class="user-badge" style="display: none;">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <span id="userDisplayName"></span>
            <!-- Dropdown menu -->
            <div class="user-dropdown" id="userDropdown">
                <button class="dropdown-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>

        <button class="login-button" id="loginButton">
            <i class="fas fa-user"></i> Iniciar Sesión
        </button>

        <!-- Barra lateral -->
        <div class="sidebar">
            <button class="sidebar-button active" onclick="showSection('play')">
                <i class="fas fa-gamepad"></i> Jugar
            </button>
            <button class="sidebar-button" onclick="showSection('profiles')">
                <i class="fas fa-user"></i> Perfiles
            </button>
            <button class="sidebar-button" onclick="showSection('mods')">
                <i class="fas fa-puzzle-piece"></i> Mods
            </button>
            <button class="sidebar-button" onclick="showSection('settings')">
                <i class="fas fa-cog"></i> Configuración
            </button>
        </div>

        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Sección Jugar -->
            <div id="play" class="section active">
                <h1>Jugar</h1>
                <select id="profileSelect" style="display: none;"></select>
                <div class="play-section">
                    <div class="custom-select" id="customSelect">
                        <div class="select-trigger" id="selectTrigger">
                            <div class="select-trigger-content">
                                <img src="" alt="" class="select-trigger-icon" id="selectedIcon">
                                <div class="select-trigger-text">
                                    <div class="select-trigger-title" id="selectedTitle">No tienes perfiles</div>
                                    <div class="select-trigger-subtitle" id="selectedSubtitle">Crea un perfil para jugar
                                    </div>
                                </div>
                            </div>
                            <div class="select-arrow"></div>
                        </div>

                        <div class="select-options" id="selectOptions">
                            <!-- Las opciones se cargarán dinámicamente aquí -->
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="openDownloadModalBtn" class="btn-secondary" style="flex: 1;"
                            data-tooltip="Descarga nuevas versiones de Minecraft (Vanilla, Forge, Fabric)">
                            <i class="fas fa-download"></i> Descargar Versiones
                        </button>
                    </div>

                    <button class="play-button" onclick="launchGame()">
                        Jugar
                    </button>
                </div>
            </div>

            <!-- Sección Perfiles -->
            <div id="profiles" class="section">
                <h1>Perfiles</h1>
                <div class="profiles-section">
                    <button id="createProfileBtn" class="btn-primary create-profile-btn">
                        <i class="fas fa-plus"></i> Crear nuevo perfil
                    </button>
                    <div id="profilesList">
                        <!-- Los perfiles se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Sección Mods -->
            <div id="mods" class="section">
                <h1>Mods</h1>
                <div class="mods-section">
                    <!-- Selector de Perfil -->
                    <div class="input-group">
                        <label>
                            Perfil
                            <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                data-tooltip="Selecciona un perfil con Forge o Fabric para gestionar mods"></i>
                        </label>
                        <select id="modsProfileSelect">
                            <option value="">Cargando perfiles...</option>
                        </select>
                    </div>

                    <!-- Mensaje si no hay perfiles moddables -->
                    <div id="noModdableProfiles" class="no-moddable-profiles" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <p>No tienes perfiles con Forge o Fabric. Crea un perfil con un loader de mods para poder
                            descargar mods.</p>
                    </div>

                    <!-- Contenedor de pestañas -->
                    <div id="modsTabsContainer" style="display: none;">
                        <!-- Pestañas -->
                        <div class="mods-tabs">
                            <button class="mod-tab active" data-tab="download">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                            <button class="mod-tab" data-tab="installed">
                                <i class="fas fa-cube"></i> Instalados
                            </button>
                        </div>

                        <!-- Contenido de pestaña: Descargar -->
                        <div id="modTabDownload" class="mod-tab-content active">
                            <!-- Barra de búsqueda -->
                            <div class="mod-search-container">
                                <input type="text" id="modSearchInput" class="mod-search-bar"
                                    placeholder="Buscar mods en Modrinth...">
                            </div>

                            <!-- Estado de carga -->
                            <div id="modSearchLoading" class="mod-search-loading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Buscando mods...</p>
                            </div>

                            <!-- Grid de resultados -->
                            <div id="modSearchResults" class="mod-grid">
                                <!-- Mensaje inicial -->
                                <div class="mod-search-empty">
                                    <i class="fas fa-search"></i>
                                    <p>Busca mods para descargar</p>
                                </div>
                            </div>
                        </div>

                        <!-- Contenido de pestaña: Instalados -->
                        <div id="modTabInstalled" class="mod-tab-content">
                            <!-- Lista de mods instalados -->
                            <div id="installedModsList" class="installed-mods-list">
                                <!-- Los mods se cargarán dinámicamente -->
                                <div class="no-mods-message">
                                    <i class="fas fa-cube"></i>
                                    <p>No hay mods instalados en este perfil</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección Configuración -->
            <div id="settings" class="section">
                <h1>Configuración</h1>
                <div class="play-section">
                    <div class="input-group">
                        <label>
                            Directorio de .minecraft
                            <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                data-tooltip="Carpeta donde se detectarán las versiones del juego (independientemente de los mods, mundos, que se detectan en el directorio de cada perfil)."></i>
                        </label>
                        <div style="display: flex; gap: 8px;">
                            <input id="mcdir" type="text" style="flex: 1;">
                            <button type="button" id="selectMcdirBtn" class="btn-square"><i
                                    class="fas fa-folder-open"></i></button>
                        </div>
                        <div class="input-group">
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="devModeCheckbox">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">
                                    Modo Desarrollador
                                    <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                        data-tooltip="Activa herramientas de desarrollo: F5 para recargar, consola de Minecraft visible, y DevTools del navegador. Requiere reiniciar el launcher."></i>
                                </span>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="guardarDatos()">Guardar Configuración</button>

                        <!-- Versión del launcher -->
                        <div
                            style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); text-align: center;">
                            <p style="color: #aaa; font-size: 13px;">
                                Versión del launcher: <span id="launcherVersion"
                                    style="color: #5cb85c; font-weight: 600;">Cargando...</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de crear perfil -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span>Crear Nuevo Perfil</span>
            <div class="profile-icon-display" id="iconDisplay">
                <img src="" alt="Icono del Perfil" class="profile-icon-img" id="iconPreview" style="display: none;">
                <span class="placeholder-icon-small" id="placeholderIcon"><i class="fas fa-user"></i></span>
            </div>
            <button type="button" class="btn-add-icon" id="iconButton"
                data-tooltip="Selecciona un icono personalizado para identificar visualmente este perfil">Añadir
                Icono</button>
            <div class="modal-input-group">
                <label>
                    Nombre del Perfil
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Nombre identificativo para este perfil. Ejemplo: 'Survival 1.20', 'Modpack SkyFactory'"></i>
                </label>
                <input id="profileName" type="text">
            </div>
            <div class="modal-input-group">
                <label>
                    Versión
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Versión de Minecraft a usar. Solo versiones ya instaladas."></i>
                </label>
                <select name="create-profile-version" id="profileVersionSelect">
                </select>
            </div>
            <div class="modal-input-group">
                <label>
                    Directorio
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Carpeta donde se guardarán los datos de este perfil (mundos, mods, configuración). Cada perfil puede tener su propia carpeta."></i>
                </label>
                <div style="display: flex; gap: 8px;">
                    <input id="profileDir" type="text" style="flex: 1;">
                    <button type="button" id="selectFolderBtn" class="btn-square"><i
                            class="fas fa-folder-open"></i></button>
                </div>
            </div>
            <div class="modal-input-group">
                <label>
                    Argumentos JVM
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Parámetros avanzados para la JVM. Por defecto se incluyen: -Xmx4G (4GB RAM), -Xms1G (1GB inicial), y optimizaciones de rendimiento con G1GC."></i>
                </label>
                <input id="profileJVMArgs" type="text">
            </div>

            <div class="modal-options">
                <button id="acceptProfileBtn" class="btn-blue">Crear</button>
                <button id="cancelModalBtn" class="btn-red">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de selección de imagen -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-selector-modal">
            <span>Seleccionar Imagen de Perfil</span>
            <div class="image-grid" id="imageGrid">
                <!-- Las imágenes se cargarán dinámicamente aquí -->
                <!-- Botón de upload personalizado al final del grid -->
                <label for="customImageInput" class="image-grid-item upload-item">
                    <span class="upload-plus"><i class="fas fa-plus"></i></span>
                </label>
                <input type="file" id="customImageInput" class="icon-input"
                    accept="image/png,image/jpeg,image/jpg,image/gif">
            </div>
            <div class="modal-options">
                <button id="cancelImageModalBtn" class="btn-red">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de inicio de sesión -->
    <div class="modal" id="loginModal">
        <div class="modal-content login-modal">
            <button class="modal-close-btn" id="closeLoginModal">
                <i class="fas fa-times"></i>
            </button>

            <!-- Pantalla 1: Selección de Método -->
            <div id="loginMethodScreen" class="login-screen active">
                <span class="modal-title">¿Cómo quieres jugar?</span>
                <p style="text-align: center; margin-bottom: 30px; color: #666;">
                    Elige tu método de inicio de sesión
                </p>

                <button class="btn-primary btn-large" id="selectMicrosoftBtn">
                    <i class="fab fa-microsoft"></i> Iniciar Sesión con Microsoft
                </button>

                <button class="btn-secondary btn-link" id="selectOfflineBtn">
                    Continuar en modo Offline
                </button>
            </div>

            <!-- Pantalla 2: Modo Offline -->
            <div id="loginOfflineScreen" class="login-screen">
                <span class="modal-title">Modo Offline</span>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">
                    Ingresa tu nickname para jugar
                </p>

                <div class="modal-input-group">
                    <label>
                        Nickname
                        <i class="fa-regular fa-question-circle help-icon"
                            data-tooltip="Tu nombre de usuario en el juego. Solo letras y números, sin espacios ni caracteres especiales."></i>
                    </label>
                    <input id="nickname" type="text" placeholder="Escribe tu nickname">
                </div>

                <div class="modal-options">
                    <button class="btn-secondary" id="backToMethodBtn" style="color: #131313;">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn-primary" id="saveOfflineBtn">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de descarga de versiones -->
    <div class="modal" id="downloadModal">
        <div class="modal-content download-modal">
            <span>Descargar Versión de Minecraft</span>

            <!-- Loader Type Selection -->
            <div class="loader-type-selector">
                <button class="loader-type-btn active" data-type="vanilla">
                    <i class="fas fa-cube"></i> Vanilla
                </button>
                <button class="loader-type-btn" data-type="forge">
                    <i class="fas fa-hammer"></i> Forge
                </button>
                <button class="loader-type-btn" data-type="fabric">
                    <i class="fas fa-scroll"></i> Fabric
                </button>
            </div>

            <!-- MC Version Dropdown -->
            <div class="modal-input-group">
                <label>
                    Versión de Minecraft
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Selecciona la versión de Minecraft que deseas descargar"></i>
                </label>
                <select id="downloadMcVersion">
                    <option value="">Cargando versiones...</option>
                </select>
            </div>

            <!-- Loader Version Dropdown (hidden for vanilla) -->
            <div class="modal-input-group" id="loaderVersionGroup" style="display: none;">
                <label id="loaderVersionLabel">
                    Versión del Loader
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Selecciona la versión del loader (Forge o Fabric)"></i>
                </label>
                <select id="downloadLoaderVersion">
                    <option value="">Selecciona primero una versión de Minecraft</option>
                </select>
            </div>

            <!-- Download Progress -->
            <div id="downloadProgressContainer" class="install-progress" style="display: none;">
                <button id="cancelDownloadBtn2" class="cancel-download-icon" title="Cancelar descarga">
                    <i class="fas fa-times"></i>
                </button>
                <div class="install-progress-text" id="downloadProgressText">Descargando...</div>
                <div class="progress-bar">
                    <div id="downloadProgressBarFill" class="progress-bar-fill" style="width: 0%;"></div>
                </div>
                <div id="downloadProgressPercentage" class="progress-percentage">0%</div>
            </div>

            <div class="modal-options">
                <button id="startDownloadBtn" class="btn-blue">
                    <i class="fas fa-download"></i> Descargar
                </button>
                <button id="cancelDownloadModalBtn" class="btn-red">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Sin Internet -->
    <div class="modal" id="noInternetModal" style="display: none;">
        <div class="modal-content no-internet-modal">
            <div class="no-internet-icon">
                <span class="no-internet-symbol">⚠</span>
            </div>
            <span class="modal-title">Sin Conexión a Internet</span>
            <p class="no-internet-message">
                No se pudo detectar una conexión a internet. Algunas funciones pueden no estar disponibles:
            </p>
            <ul class="no-internet-features">
                <li>Búsqueda y descarga de mods</li>
                <li>Actualizaciones automáticas</li>
                <li>Descarga de nuevas versiones de Minecraft</li>
            </ul>

            <button class="btn-primary btn-large" id="closeAppBtn">
                ✕ Cerrar Aplicación
            </button>

            <button class="btn-continue-anyway" id="continueAnywayBtn">
                Continuar sin conexión
            </button>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content" style="width: 600px; background-color: #2b2b2b; color: #fff;">
            <h2 id="errorModalTitle" style="color: #ff5555; margin-bottom: 15px;">Error de Lanzamiento</h2>
            <p id="errorModalMessage" style="color: #ddd; margin-bottom: 20px;">Ocurrió un error al iniciar Minecraft.
            </p>

            <div id="javaDownloadSection"
                style="display: none; margin-bottom: 20px; background: rgba(255, 170, 0, 0.1); padding: 15px; border-radius: 5px; border-left: 4px solid #ffaa00;">
                <p style="margin-bottom: 10px; color: #ffaa00;">Parece que necesitas una versión más reciente de Java.
                </p>
                <a href="https://adoptium.net/" target="_blank" class="btn-primary"
                    style="display: inline-block; text-decoration: none; text-align: center;">Descargar Java
                    (Adoptium)</a>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #aaa;">Registro de error
                    (Log):</label>
                <textarea id="errorLogContent" readonly
                    style="width: 100%; height: 200px; background: #1a1a1a; color: #ddd; border: 1px solid #444; padding: 10px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
            </div>

            <div class="modal-options">
                <button onclick="copyErrorLog()" class="btn-secondary">Copiar Log</button>
                <button onclick="closeErrorModal()" class="btn-red">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="scripts.js"></script>
</body>

</html>