<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <!-- Initial Loader -->
    <div id="initialLoader" class="loader-container">
        <div class="cube-spinner">
            <div class="face-back"></div>
            <div class="face-right"></div>
            <div class="face-left"></div>
            <div class="face-top"></div>
            <div class="face-bottom"></div>
            <div class="face-front"></div>
        </div>
    </div>

    <!-- Background Animation Container -->
    <div id="background-animation">
        <canvas id="starfield"></canvas>
    </div>

    <div class="launcher">
        <!-- Login Button / User Badge -->
        <div id="userBadge" class="user-badge" style="display: none;">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <span id="userDisplayName"></span>
            <!-- Dropdown menu -->
            <div class="user-dropdown" id="userDropdown">
                <button class="dropdown-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <button class="login-button" id="loginButton">
            <i class="fas fa-user"></i> Login
        </button>

        <!-- Sidebar -->
        <div class="sidebar">
            <button class="sidebar-button active" onclick="showSection('play')">
                <i class="fas fa-gamepad"></i> Play
            </button>
            <button class="sidebar-button" onclick="showSection('profiles')">
                <i class="fas fa-user"></i> Profiles
            </button>
            <button class="sidebar-button" onclick="showSection('mods')">
                <i class="fas fa-puzzle-piece"></i> Mods
            </button>
            <button class="sidebar-button" onclick="showSection('settings')">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Play Section -->
            <div id="play" class="section active">
                <h1>Play</h1>
                <select id="profileSelect" style="display: none;"></select>
                <div class="play-section">
                    <div class="custom-select" id="customSelect">
                        <div class="select-trigger" id="selectTrigger">
                            <div class="select-trigger-content">
                                <img src="" alt="" class="select-trigger-icon" id="selectedIcon">
                                <div class="select-trigger-text">
                                    <div class="select-trigger-title" id="selectedTitle">No profiles found</div>
                                    <div class="select-trigger-subtitle" id="selectedSubtitle">Create a profile to play
                                    </div>
                                </div>
                            </div>
                            <div class="select-arrow"></div>
                        </div>

                        <div class="select-options" id="selectOptions">
                            <!-- Options will be loaded dynamically here -->
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="openDownloadModalBtn" class="btn-secondary" style="flex: 1;"
                            data-tooltip="Download new versions of Minecraft (Vanilla, Forge, Fabric)">
                            <i class="fas fa-download"></i> Download Versions
                        </button>
                    </div>

                    <button class="play-button" onclick="launchGame()">
                        Play
                    </button>
                </div>
            </div>

            <!-- Profiles Section -->
            <div id="profiles" class="section">
                <h1>Profiles</h1>
                <div class="profiles-section">
                    <button id="createProfileBtn" class="btn-primary create-profile-btn">
                        <i class="fas fa-plus"></i> Create new profile
                    </button>
                    <div id="profilesList">
                        <!-- Profiles will be loaded here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Mods Section -->
            <div id="mods" class="section">
                <h1>Mods</h1>
                <div class="mods-section">
                    <!-- Profile Selector -->
                    <div class="input-group">
                        <label>
                            Profile
                            <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                data-tooltip="Select a profile with Forge or Fabric to manage mods"></i>
                        </label>
                        <select id="modsProfileSelect">
                            <option value="">Loading profiles...</option>
                        </select>
                    </div>

                    <!-- Message if no moddable profiles -->
                    <div id="noModdableProfiles" class="no-moddable-profiles" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <p>No profiles with Forge or Fabric. Create a profile with a mod loader to download mods.</p>
                    </div>

                    <!-- Tab Container -->
                    <div id="modsTabsContainer" style="display: none;">
                        <!-- Tabs -->
                        <div class="mods-tabs">
                            <button class="mod-tab active" data-tab="download">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="mod-tab" data-tab="installed">
                                <i class="fas fa-cube"></i> Installed
                            </button>
                        </div>

                        <!-- Tab Content: Download -->
                        <div id="modTabDownload" class="mod-tab-content active">
                            <!-- Search Bar -->
                            <div class="mod-search-container">
                                <input type="text" id="modSearchInput" class="mod-search-bar"
                                    placeholder="Search mods in Modrinth...">
                            </div>

                            <!-- Loading State -->
                            <div id="modSearchLoading" class="mod-search-loading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Searching mods...</p>
                            </div>

                            <!-- Results Grid -->
                            <div id="modSearchResults" class="mod-grid">
                                <!-- Initial Message -->
                                <div class="mod-search-empty">
                                    <i class="fas fa-search"></i>
                                    <p>Search mods to download</p>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Content: Installed -->
                        <div id="modTabInstalled" class="mod-tab-content">
                            <!-- Installed Mods List -->
                            <div id="installedModsList" class="installed-mods-list">
                                <!-- Mods will be loaded dynamically -->
                                <div class="no-mods-message">
                                    <i class="fas fa-cube"></i>
                                    <p>No mods installed in this profile</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="section">
                <h1>Settings</h1>
                <div class="play-section">
                    <div class="input-group">
                        <label>
                            .minecraft Directory
                            <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                data-tooltip="Folder where game versions will be detected (independent of mods, worlds, which are detected in each profile's directory)."></i>
                        </label>
                        <div style="display: flex; gap: 8px;">
                            <input id="mcdir" type="text" style="flex: 1;">
                            <button type="button" id="selectMcdirBtn" class="btn-square"><i
                                    class="fas fa-folder-open"></i></button>
                        </div>
                        <div class="input-group">
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="devModeCheckbox">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">
                                    Developer Mode
                                    <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                        data-tooltip="Enables development tools: F5 to reload, Minecraft console visible, and browser DevTools. Requires launcher restart."></i>
                                </span>
                            </div>
                        </div>

                        <div class="input-group">
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showSnapshotsCheckbox">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">
                                    Show Snapshots
                                    <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                        data-tooltip="Shows development versions (snapshots) in the version selector."></i>
                                </span>
                            </div>
                        </div>

                        <div class="input-group">
                            <div class="toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showOldVersionsCheckbox">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">
                                    Show Old Versions
                                    <i class="fa-regular fa-question-circle help-icon" style="color: #fff;"
                                        data-tooltip="Shows old Alpha and Beta versions in the version selector."></i>
                                </span>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="saveSettings()">Save Settings</button>

                        <!-- Launcher Version -->
                        <div
                            style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); text-align: center;">
                            <p style="color: #aaa; font-size: 13px;">
                                Launcher Version: <span id="launcherVersion"
                                    style="color: #5cb85c; font-weight: 600;">Loading...</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Profile Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span>Create New Profile</span>
            <div class="profile-icon-display" id="iconDisplay">
                <img src="" alt="Profile Icon" class="profile-icon-img" id="iconPreview" style="display: none;">
                <span class="placeholder-icon-small" id="placeholderIcon"><i class="fas fa-user"></i></span>
            </div>
            <button type="button" class="btn-add-icon" id="iconButton"
                data-tooltip="Select a custom icon to visually identify this profile">Add Icon</button>
            <div class="modal-input-group">
                <label>
                    Profile Name
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Name to identify this profile. Example: 'Survival 1.20', 'SkyFactory Modpack'"></i>
                </label>
                <input id="profileName" type="text">
            </div>
            <div class="modal-input-group">
                <label>
                    Version
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Minecraft version to use. Download new Minecraft versions from the Version Downloader."></i>
                </label>
                <select name="create-profile-version" id="profileVersionSelect">
                </select>
            </div>
            <div class="modal-input-group">
                <label>
                    Directory
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Folder where this profile's data will be saved (worlds, mods, settings). Each profile can have its own folder."></i>
                </label>
                <div style="display: flex; gap: 8px;">
                    <input id="profileDir" type="text" style="flex: 1;">
                    <button type="button" id="selectFolderBtn" class="btn-square"><i
                            class="fas fa-folder-open"></i></button>
                </div>
            </div>
            <div class="modal-input-group">
                <label>
                    JVM Arguments
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Advanced JVM parameters. Defaults include: -Xmx4G (4GB RAM), -Xms1G (1GB initial), and performance optimizations with G1GC."></i>
                </label>
                <input id="profileJVMArgs" type="text">
            </div>

            <div class="modal-options">
                <button id="acceptProfileBtn" class="btn-blue">Create</button>
                <button id="cancelModalBtn" class="btn-red">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Image Selection Modal -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-selector-modal">
            <span>Select Profile Image</span>
            <div class="image-grid" id="imageGrid">
                <!-- Images will be loaded dynamically here -->
                <!-- Custom upload button at the end of the grid -->
                <label for="customImageInput" class="image-grid-item upload-item">
                    <span class="upload-plus"><i class="fas fa-plus"></i></span>
                </label>
                <input type="file" id="customImageInput" class="icon-input"
                    accept="image/png,image/jpeg,image/jpg,image/gif">
            </div>
            <div class="modal-options">
                <button id="cancelImageModalBtn" class="btn-red">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content login-modal">
            <button class="modal-close-btn" id="closeLoginModal">
                <i class="fas fa-times"></i>
            </button>

            <!-- Screen 1: Method Selection -->
            <div id="loginMethodScreen" class="login-screen active">
                <span class="modal-title">How do you want to play?</span>
                <p style="text-align: center; margin-bottom: 30px; color: #666;">
                    Choose your login method
                </p>

                <button class="btn-primary btn-large" id="selectMicrosoftBtn">
                    <i class="fab fa-microsoft"></i> Login with Microsoft
                </button>

                <button class="btn-secondary btn-link" id="selectOfflineBtn">
                    Continue in Offline mode
                </button>
            </div>

            <!-- Screen 2: Offline Mode -->
            <div id="loginOfflineScreen" class="login-screen">
                <span class="modal-title">Offline Mode</span>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">
                    Enter your nickname to play
                </p>

                <div class="modal-input-group">
                    <label>
                        Nickname
                        <i class="fa-regular fa-question-circle help-icon"
                            data-tooltip="Your in-game username. Only letters and numbers, no spaces or special characters."></i>
                    </label>
                    <input id="nickname" type="text" placeholder="Type your nickname">
                </div>

                <div class="modal-options">
                    <button class="btn-secondary" id="backToMethodBtn" style="color: #a3a3a3;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn-primary" id="saveOfflineBtn">Enter</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Modal -->
    <div class="modal" id="downloadModal">
        <div class="modal-content download-modal">
            <span>Download Minecraft Version</span>

            <!-- Loader Type Selection -->
            <div class="loader-type-selector">
                <button class="loader-type-btn active" data-type="vanilla">
                    <i class="fas fa-cube"></i> Vanilla
                </button>
                <button class="loader-type-btn" data-type="forge">
                    <i class="fas fa-hammer"></i> Forge
                </button>
                <button class="loader-type-btn" data-type="fabric">
                    <i class="fas fa-scroll"></i> Fabric
                </button>
            </div>

            <!-- MC Version Dropdown -->
            <div class="modal-input-group">
                <label>
                    Minecraft Version
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Select the Minecraft version you want to download"></i>
                </label>
                <select id="downloadMcVersion">
                    <option value="">Loading...</option>
                </select>
            </div>

            <!-- Loader Version Dropdown (hidden for vanilla) -->
            <div class="modal-input-group" id="loaderVersionGroup" style="display: none;">
                <label id="loaderVersionLabel">
                    Loader Version
                    <i class="fa-regular fa-question-circle help-icon"
                        data-tooltip="Select the loader version (Forge or Fabric)"></i>
                </label>
                <select id="downloadLoaderVersion">
                    <option value="">Loading...</option>
                </select>
            </div>

            <!-- Download Progress -->
            <div id="downloadProgressContainer" class="install-progress" style="display: none;">
                <button id="cancelDownloadBtn2" class="cancel-download-icon" title="Cancel download">
                    <i class="fas fa-times"></i>
                </button>
                <div class="install-progress-text" id="downloadProgressText">Downloading...</div>
                <div class="progress-bar">
                    <div id="downloadProgressBarFill" class="progress-bar-fill" style="width: 0%;"></div>
                </div>
                <div id="downloadProgressPercentage" class="progress-percentage">0%</div>
            </div>

            <div class="modal-options">
                <button id="startDownloadBtn" class="btn-blue">
                    <i class="fas fa-download"></i> Download
                </button>
                <button id="cancelDownloadModalBtn" class="btn-red">Cancel</button>
            </div>
        </div>
    </div>

    <!-- No Internet Modal -->
    <div class="modal" id="noInternetModal" style="display: none;">
        <div class="modal-content no-internet-modal">
            <div class="no-internet-icon">
                <span class="no-internet-symbol">⚠</span>
            </div>
            <span class="modal-title">No Internet Connection</span>
            <p class="no-internet-message">
                Could not detect an internet connection. Some features may not be available:
            </p>
            <ul class="no-internet-features">
                <li>Mod searching and downloading</li>
                <li>Automatic updates</li>
                <li>Downloading new Minecraft versions</li>
            </ul>

            <button class="btn-primary btn-large" id="closeAppBtn">
                ✕ Close Application
            </button>

            <button class="btn-continue-anyway" id="continueAnywayBtn">
                Continue anyway
            </button>
        </div>
    </div>

    <!-- Mod Details Modal -->
    <div id="modDetailsModal" class="modal">
        <div class="modal-content mod-details-modal">
            <button class="modal-close-btn" onclick="closeModDetails()" style="z-index: 10;">
                <i class="fas fa-times"></i>
            </button>

            <div class="mod-details-header">
                <img src="" alt="" class="mod-details-icon" id="modDetailIcon">
                <div class="mod-details-title-section">
                    <div class="mod-details-title" id="modDetailTitle">Mod Title</div>
                    <div class="mod-details-author" id="modDetailAuthor">by Author</div>
                    <div class="mod-card-categories" id="modDetailCategories"></div>
                </div>
                <div style="width: 200px; margin-right: 40px;">
                    <button id="modDetailInstallBtn" class="btn-primary" style="width: 100%; height: 50px;">
                        <i class="fas fa-download"></i> Install
                    </button>
                </div>
            </div>

            <div class="mod-details-content">
                <div class="mod-details-main">
                    <div id="modDetailDescription" class="markdown-body">
                        <div style="text-align: center; padding: 50px;">
                            <span class="spinner"></span>
                        </div>
                    </div>
                </div>

                <div class="mod-details-sidebar">
                    <div class="sidebar-section">
                        <div class="sidebar-title">Information</div>
                        <div class="info-row">
                            <span class="info-label">Downloads</span>
                            <span class="info-value" id="modDetailDownloads">Loading...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Updated</span>
                            <span class="info-value" id="modDetailUpdated">Loading...</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">License</span>
                            <span class="info-value" id="modDetailLicense">Loading...</span>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="sidebar-title">Gallery</div>
                        <div class="mod-gallery" id="modDetailGallery"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content" style="width: 600px; background-color: #2b2b2b; color: #fff;">
            <h2 id="errorModalTitle" style="color: #ff5555; margin-bottom: 15px;">Launch Error</h2>
            <p id="errorModalMessage" style="color: #ddd; margin-bottom: 20px;">An error occurred while starting
                Minecraft.
            </p>

            <div id="javaDownloadSection"
                style="display: none; margin-bottom: 20px; background: rgba(255, 170, 0, 0.1); padding: 15px; border-radius: 5px; border-left: 4px solid #ffaa00;">
                <p style="margin-bottom: 10px; color: #ffaa00;">It seems you need a newer version of Java.
                </p>
                <a href="https://adoptium.net/" target="_blank" class="btn-primary"
                    style="display: inline-block; text-decoration: none; text-align: center;">Download Java
                    (Adoptium)</a>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #aaa;">Error log:</label>
                <textarea id="errorLogContent" readonly
                    style="width: 100%; height: 200px; background: #1a1a1a; color: #ddd; border: 1px solid #444; padding: 10px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
            </div>

            <div class="modal-options">
                <button onclick="copyErrorLog()" class="btn-secondary">Copy Log</button>
                <button onclick="closeErrorModal()" class="btn-red">Close</button>
            </div>
        </div>
    </div>

    <script src="scripts.js"></script>
</body>

</html>